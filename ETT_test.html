<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Etape du Tour</title>
    <meta http-equiv="content-Language" content="fr" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" integrity="sha512-Qlv6VSKh1gDKGoJbnyA5RMXYcvnpIqhO++MhIM2fStMcGT9i2T//tSwYFlcyoRRDcDZ+TYHpH8azBBCyhpSeqw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      body {
        background-image: url('pn.png');
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-size: cover;
      }
    </style>
</head>
<body> 
  
  <div id="result"></div>
  <script>
    //FORMULAIRE 

    let name = prompt("Entrez le nom du coureur :");

    //DOCUMENT CVS

    let contenu = `Dossard,Nom,Prénom,DateNaissance,Bidon,Sac,TshirtS,TshirtM,TshirtL,TshirtXL,TshirtXXL
39,GEBEL,Hervé,6/3/1976,1,,,,,,
48,POULIZAC,Ronan,10/26/1988,1,,,,,,
62,TESSIER,Matthieu,2/14/1986,1,,,,,,
86,MEHAT,Brice,11/8/1990,1,,,,,,
119,GRILLET,Sébastien,2/12/1984,1,,,,,,`;

    //RECUPERATION DES DONNEES

    let lines = contenu.split("\n");
    for (let line of lines) {
        let cells = line.split(",");
        let Dossard = cells[0];
        let Nom = cells[1];
        let Prenom = cells[2];
        let Date_de_Naissance = cells[3];
        let Bidon = cells[4];
        let Sac = cells[5];
        let Tshirt_S = cells[6];
        let Tshirt_M = cells[7];
        let Tshirt_L = cells[8];
        let Tshirt_XL = cells[9];
        let Tshirt_XXL = cells[10];

        //TRI ET AFFICHAGE CONSOLE

        if (name == Nom) 
        {
            document.getElementById("result").innerHTML += '<font size="6"></font>';
            document.getElementById("result").innerHTML += '<p style="text-align: center"></p>';
            document.getElementById("result").innerHTML += "__________________________________________<br/>";
            document.getElementById("result").innerHTML += Nom + " " + Prenom + "<br/>";
            document.getElementById("result").innerHTML += " Né le " + " " + Date_de_Naissance + " <br/>";
            document.getElementById("result").innerHTML += Bidon + " " + " bidon <br/>";
            document.getElementById("result").innerHTML += Sac + " " + " sac <br/>";
            document.getElementById("result").innerHTML += Tshirt_S + " " + " Tshirt XS <br/>";
            document.getElementById("result").innerHTML += Tshirt_M + " " + " Tshirt S <br/>";
            document.getElementById("result").innerHTML += Tshirt_L + " " + " Tshirt M <br/>";
            document.getElementById("result").innerHTML += Tshirt_XL + " " + " Tshirt L <br/>";
            document.getElementById("result").innerHTML += Tshirt_XXL + " " + " Tshirt XL <br/>";
            // Ajouter les boutons Valider et Annuler
            document.getElementById("result").innerHTML += '<button onclick="valider()">Valider</button>';
            document.getElementById("result").innerHTML += '<button onclick="annuler()">Annuler</button>';

            break; // Sortir de la boucle après avoir trouvé le nom correspondant
        }
    }

    function valider() {
        // Recherche du nom dans le fichier Doc.csv et ajout de "##" à la ligne correspondante

        // Envoie de la requête AJAX pour effectuer la modification
        let xhr = new XMLHttpRequest();
        xhr.open('POST', 'modifier.php', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                alert("Modification effectuée avec succès !");
            } else if (xhr.readyState === 4 && xhr.status !== 200) {
                alert("Erreur lors de la modification.");
            }
        };
        xhr.send('name=' + encodeURIComponent(name));
    }

    function annuler() {
        // Recharger la page pour saisir un nouveau nom
        location.reload();
    }
  </script>
</body>
</html>
